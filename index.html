<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pipél Chat</title>
    <style>
        @font-face {
            font-family: 'CustomMono';
            src: url('font.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        body {
            background-color: #000;
            color: #fff;
            font-family: 'CustomMono', 'Courier New', monospace;
            margin: 0;
            padding: 20px;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        #terminal {
            flex: 1;
            overflow-y: auto;
        }
        #input-line {
            display: flex;
            flex-shrink: 0;
            margin-top: 5px;
        }
        #prompt {
            white-space: nowrap;
            margin-right: 10px;
        }
        #command-input {
            background-color: transparent;
            border: none;
            color: #fff;
            font-family: 'CustomMono', 'Courier New', monospace;
            font-size: 16px;
            width: 100%;
            outline: none;
        }
        .output {
            white-space: pre-wrap;
            margin: 5px 0;
            color: #0f0; /* Зеленый для вывода */
        }
        .command {
            margin: 5px 0;
            color: #fff;
        }
        .chat-message {
            margin: 2px 0;
            color: #ff0; /* Желтый для чат-сообщений */
        }
        .user-chat-message {
            margin: 2px 0;
            color: #0ff; /* Голубой для сообщений пользователя */
        }
    </style>
</head>
<body>
    <div id="terminal">
        <div class="output" id="welcome"></div>
        <div class="output" id="help-hint">Type 'help' for available commands</div>
    </div>
    <div id="input-line">
        <span id="prompt">user@localhost:~$</span>
        <input type="text" id="command-input" autofocus>
    </div>

    <script>
        const terminal = document.getElementById('terminal');
        const commandInput = document.getElementById('command-input');
        const prompt = document.getElementById('prompt');
        
        // Language support
        let currentLang = 'en';
        const translations = {
            en: {
                welcome: '***',
                helpHint: "Type 'help' for available commands",
                help: `Available commands:
- help: Show this help message
- clear: Clear the terminal
- date: Show current date and time
- nick [name]: Set your nickname
- obchat: Enter general chat (type /exit to leave)
- tongue [lang]: Change language (en, ru, zh)`,
                adminHelp: `\nAdmin commands (nk.exe2089 only):
- ban [nick] [time] [reason]: Ban a user from entering chat
- users_ip: Show users in general chat and recent logins with IP, nick, and entry time`,
                dateCmd: () => new Date().toString(),
                nickSet: (nick) => `Nickname set to ${nick}`,
                nickUsage: 'Usage: nick <name>',
                setNickFirst: 'Please set a nickname first using "nick <name>".',
                obchatEnter: 'Entered general chat. Type messages to chat. Use /exit to leave.',
                obchatLeave: 'Left general chat.',
                unknownChatCmd: (cmd) => `Unknown chat command: /${cmd}`,
                unknownLang: (lang) => `Unknown language: ${lang}. Available: en, ru, zh`,
                tongueUsage: 'Usage: tongue <lang> (en, ru, zh)',
                onlyAdmin: 'This command is only available to the admin.',
                banUsage: 'Usage: ban <nick> <time> [reason]\nTime format: 30s, 50m, 78h, 79d (or 30с, 50м, 78ч, 79д)',
                banSet: (nick, end, reason) => `User ${nick} has been banned until ${end} for: ${reason}`,
                youBanned: (end, reason) => `You are banned from entering chat until ${end} for: ${reason}`,
                usersIpTitle: 'Users IP List\nNick\tIP\tEntry Time\n',
                chatUsers: ['Alice', 'Bob', 'Charlie', 'Dana', 'Eve'],
                chatMessages: [
                    'Hello everyone!',
                    'How are you?',
                    'Interesting topic.',
                    'I agree!',
                    'Tell me more.',
                    'Haha, cool!',
                    'Disagree, why?',
                    'Thanks for the info.'
                ]
            },
            ru: {
                welcome: '***',
                helpHint: "Введите 'help' для списка команд",
                help: `Доступные команды:
- help: Показать это сообщение помощи
- clear: Очистить терминал
- date: Показать текущую дату и время
- nick [имя]: Установить ваш никнейм
- obchat: Войти в общий чат (введите /exit для выхода)
- tongue [lang]: Сменить язык (en, ru, zh)`,
                adminHelp: `\nКоманды администратора (только для nk.exe2089):
- ban [ник] [время] [причина]: Забанить пользователя от входа в чат
- users_ip: Показать пользователей в общем чате и недавние входы с IP, ником и временем входа`,
                dateCmd: () => new Date().toLocaleString('ru-RU'),
                nickSet: (nick) => `Никнейм установлен: ${nick}`,
                nickUsage: 'Использование: nick <имя>',
                setNickFirst: 'Сначала установите никнейм с помощью "nick <имя>".',
                obchatEnter: 'Вошли в общий чат. Пишите сообщения для общения. Используйте /exit для выхода.',
                obchatLeave: 'Вышли из общего чата.',
                unknownChatCmd: (cmd) => `Неизвестная команда чата: /${cmd}`,
                unknownLang: (lang) => `Неизвестный язык: ${lang}. Доступны: en, ru, zh`,
                tongueUsage: 'Использование: tongue <lang> (en, ru, zh)',
                onlyAdmin: 'Эта команда доступна только администратору.',
                banUsage: 'Использование: ban <ник> <время> [причина]\nФормат времени: 30s, 50m, 78h, 79d (или 30с, 50м, 78ч, 79д)',
                banSet: (nick, end, reason) => `Пользователь ${nick} забанен до ${end} за: ${reason}`,
                youBanned: (end, reason) => `Вы забанены от входа в чат до ${end} за: ${reason}`,
                usersIpTitle: 'Список IP пользователей\nНик\tIP\tВремя входа\n',
                chatUsers: ['Алиса', 'Боб', 'Чарли', 'Дана', 'Ева'],
                chatMessages: [
                    'Привет всем!',
                    'Как дела?',
                    'Интересная тема.',
                    'Согласен!',
                    'Расскажи больше.',
                    'Ха-ха, круто!',
                    'Не согласен, почему?',
                    'Спасибо за инфу.'
                ]
            },
            zh: {
                welcome: '***',
                helpHint: "输入 'help' 查看可用命令",
                help: `可用命令:
- help: 显示此帮助消息
- clear: 清空终端
- date: 显示当前日期和时间
- nick [name]: 设置您的昵称
- obchat: 进入通用聊天 (输入 /exit 退出)
- tongue [lang]: 更改语言 (en, ru, zh)`,
                adminHelp: `\n管理员命令 (仅 nk.exe2089):
- ban [nick] [time] [reason]: 禁止用户进入聊天
- users_ip: 显示通用聊天中的用户和最近登录的 IP、昵称和进入时间`,
                dateCmd: () => new Date().toLocaleString('zh-CN'),
                nickSet: (nick) => `昵称设置为 ${nick}`,
                nickUsage: '用法: nick <name>',
                setNickFirst: '请先使用 "nick <name>" 设置昵称。',
                obchatEnter: '已进入通用聊天。输入消息聊天。使用 /exit 退出。',
                obchatLeave: '已离开通用聊天。',
                unknownChatCmd: (cmd) => `未知聊天命令: /${cmd}`,
                unknownLang: (lang) => `未知语言: ${lang}。可用: en, ru, zh`,
                tongueUsage: '用法: tongue <lang> (en, ru, zh)',
                onlyAdmin: '此命令仅管理员可用。',
                banUsage: '用法: ban <nick> <time> [reason]\n时间格式: 30s, 50m, 78h, 79d (或 30с, 50м, 78ч, 79д)',
                banSet: (nick, end, reason) => `用户 ${nick} 被禁止直到 ${end} 原因: ${reason}`,
                youBanned: (end, reason) => `您被禁止进入聊天直到 ${end} 原因: ${reason}`,
                usersIpTitle: '用户 IP 列表\n昵称\tIP\t进入时间\n',
                chatUsers: ['爱丽丝', '鲍勃', '查理', '达娜', '夏娃'],
                chatMessages: [
                    '大家好！',
                    '你好吗？',
                    '有趣的话题。',
                    '我同意！',
                    '多说说。',
                    '哈哈，酷！',
                    '不同意，为什么？',
                    '谢谢信息。'
                ]
            }
        };
        
        function updateLanguage() {
            const t = translations[currentLang];
            const welcomeEl = document.getElementById('welcome');
            if (welcomeEl) welcomeEl.textContent = t.welcome;
            const helpHintEl = document.getElementById('help-hint');
            if (helpHintEl) helpHintEl.textContent = t.helpHint;
            // Update prompt if needed, but it's dynamic
        }
        
        // Chat simulation
        let currentNick = 'user';
        let inChat = false;
        let t; // Current translations
        let bannedUsers = new Map();
        
        function getTranslations() {
            return translations[currentLang];
        }
        
        function getLocale() {
            switch (currentLang) {
                case 'en': return 'en-US';
                case 'ru': return 'ru-RU';
                case 'zh': return 'zh-CN';
                default: return 'en-US';
            }
        }
        
        function generateIP() {
            return `192.168.${Math.floor(Math.random() * 256)}.${Math.floor(Math.random() * 256)}`;
        }
        
        function parseDuration(str) {
            const match = str.match(/^(\d+)([smhdсмчд])$/i);
            if (!match) return null;
            const num = parseInt(match[1]);
            let unit = match[2].toLowerCase();
            switch (unit) {
                case 's':
                case 'с': return num * 1000;
                case 'm':
                case 'м': return num * 60 * 1000;
                case 'h':
                case 'ч': return num * 60 * 60 * 1000;
                case 'd':
                case 'д': return num * 24 * 60 * 60 * 1000;
                default: return null;
            }
        }
        
        function isAdmin() {
            return currentNick === 'nk.exe2089';
        }
        
        function generateRandomMessage() {
            t = getTranslations();
            const user = t.chatUsers[Math.floor(Math.random() * t.chatUsers.length)];
            const msg = t.chatMessages[Math.floor(Math.random() * t.chatMessages.length)];
            return `${user}: ${msg}`;
        }
        
        function simulateChatResponses() {
            t = getTranslations();
            const numResponses = Math.floor(Math.random() * 3) + 1; // 1-3 ответа
            setTimeout(() => {
                for (let i = 0; i < numResponses; i++) {
                    const msgElement = document.createElement('div');
                    msgElement.className = 'chat-message output';
                    msgElement.textContent = generateRandomMessage();
                    terminal.appendChild(msgElement);
                }
                terminal.scrollTop = terminal.scrollHeight;
            }, 500 + Math.random() * 1000); // Задержка 0.5-1.5 сек
        }
        
        // Local commands
        function updatePrompt() {
            t = getTranslations();
            if (inChat) {
                prompt.textContent = `${currentNick}@obchat: `;
            } else {
                prompt.textContent = `${currentNick}@localhost:~$`;
            }
        }
        
        const localCommands = {
            'help': () => {
                t = getTranslations();
                let helpText = t.help;
                if (isAdmin()) {
                    helpText += t.adminHelp;
                }
                return helpText;
            },
            'clear': (args) => {
                // Clear everything and reset
                terminal.innerHTML = `<div class="output" id="welcome">${getTranslations().welcome}</div>
                                      <div class="output" id="help-hint">${getTranslations().helpHint}</div>`;
                inChat = false;
                updatePrompt();
                updateLanguage();
                return '';
            },
            'date': () => {
                t = getTranslations();
                return t.dateCmd();
            },
            'nick': (args) => {
                t = getTranslations();
                if (args.length > 0) {
                    currentNick = args.join(' ');
                    updatePrompt();
                    return t.nickSet(currentNick);
                } else {
                    return t.nickUsage;
                }
            },
            'obchat': () => {
                t = getTranslations();
                if (currentNick === 'user') {
                    return t.setNickFirst;
                }
                const lowerNick = currentNick.toLowerCase();
                if (bannedUsers.has(lowerNick)) {
                    const ban = bannedUsers.get(lowerNick);
                    if (Date.now() < ban.endTime) {
                        const locale = getLocale();
                        const endStr = new Date(ban.endTime).toLocaleString(locale);
                        return t.youBanned(endStr, ban.reason);
                    } else {
                        bannedUsers.delete(lowerNick);
                    }
                }
                inChat = true;
                updatePrompt();
                return t.obchatEnter;
            },
            'tongue': (args) => {
                t = getTranslations();
                if (args.length > 0) {
                    const lang = args[0].toLowerCase();
                    if (['en', 'ru', 'zh'].includes(lang)) {
                        currentLang = lang;
                        updateLanguage();
                        updatePrompt();
                        return `Language changed to ${lang}`;
                    } else {
                        return t.unknownLang(lang);
                    }
                } else {
                    return t.tongueUsage;
                }
            },
            'ban': (args) => {
                t = getTranslations();
                if (!isAdmin()) {
                    return t.onlyAdmin;
                }
                if (args.length < 2) {
                    return t.banUsage;
                }
                const nick = args[0];
                const timeStr = args[1];
                const reason = args.slice(2).join(' ') || 'No reason provided';
                const duration = parseDuration(timeStr);
                if (!duration) {
                    return t.banUsage;
                }
                const endTime = Date.now() + duration;
                const locale = getLocale();
                const endStr = new Date(endTime).toLocaleString(locale);
                bannedUsers.set(nick.toLowerCase(), { endTime, reason });
                return t.banSet(nick, endStr, reason);
            },
            'users_ip': () => {
                t = getTranslations();
                if (!isAdmin()) {
                    return t.onlyAdmin;
                }
                let users = [];
                if (inChat) {
                    users.push({
                        nick: currentNick,
                        ip: generateIP(),
                        entryTime: Date.now() - Math.random() * 60000 // recent 1 min
                    });
                }
                const numSim = Math.floor(Math.random() * 4) + 2; // 2-5 simulated
                for (let i = 0; i < numSim; i++) {
                    let simNick;
                    do {
                        simNick = t.chatUsers[Math.floor(Math.random() * t.chatUsers.length)];
                    } while (users.some(u => u.nick === simNick)); // avoid duplicate
                    users.push({
                        nick: simNick,
                        ip: generateIP(),
                        entryTime: Date.now() - Math.random() * 86400000 // up to 1 day ago
                    });
                }
                users.sort((a, b) => b.entryTime - a.entryTime);
                let output = t.usersIpTitle;
                users.forEach(u => {
                    output += `${u.nick}\t${u.ip}\t${new Date(u.entryTime).toLocaleString(getLocale())}\n`;
                });
                return output;
            }
        };
        
        commandInput.addEventListener('keydown', async (e) => {
            if (e.key === 'Enter') {
                const commandText = commandInput.value.trim();
                commandInput.value = '';
                
                let output = '';
                
                if (inChat) {
                    if (commandText.startsWith('/')) {
                        // Echo chat commands as regular command
                        const inputElement = document.createElement('div');
                        inputElement.className = 'command';
                        inputElement.textContent = `${prompt.textContent} ${commandText}`;
                        terminal.appendChild(inputElement);
                        
                        const [chatCmd, ...args] = commandText.slice(1).split(' ');
                        if (chatCmd === 'exit') {
                            t = getTranslations();
                            inChat = false;
                            updatePrompt();
                            output = t.obchatLeave;
                        } else {
                            t = getTranslations();
                            output = t.unknownChatCmd(chatCmd);
                        }
                    } else {
                        // Chat message - no echo, just formatted message
                        t = getTranslations();
                        const msgElement = document.createElement('div');
                        msgElement.className = 'user-chat-message output';
                        msgElement.textContent = `${currentNick}: ${commandText}`;
                        terminal.appendChild(msgElement);
                        simulateChatResponses();
                        terminal.scrollTop = terminal.scrollHeight;
                        return; // No further processing
                    }
                } else {
                    // Normal command mode
                    const inputElement = document.createElement('div');
                    inputElement.className = 'command';
                    inputElement.textContent = `${prompt.textContent} ${commandText}`;
                    terminal.appendChild(inputElement);
                    
                    const [command, ...args] = commandText.split(' ');
                    if (localCommands[command]) {
                        output = localCommands[command](args);
                    } else {
                        output = `Unknown command: ${command}`;
                    }
                }
                
                if (output !== '') {
                    const outputElement = document.createElement('div');
                    outputElement.className = 'output';
                    outputElement.textContent = output;
                    terminal.appendChild(outputElement);
                }
                
                // Scroll to bottom
                terminal.scrollTop = terminal.scrollHeight;
            }
        });
        
        // Focus the input on click anywhere
        document.body.addEventListener('click', () => {
            commandInput.focus();
        });
        
        // Initial setup
        updateLanguage();
        updatePrompt();
    </script>
</body>
</html>